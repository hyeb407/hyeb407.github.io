<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./grid.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    
    <style>
        i{
            font-size: 36px;
        }

        [box-id]{
            width: 100px;
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: 0.3s;
        }

        [box-id].active{
            border: 3px dashed #00E6E6;
            box-shadow: 0 0 20 gray;
            transition: 0s;
        }

        button{
            font-size: 30px;
            width: 100%;
            height: 100%;
            border: none;
            color: #ffffff;
            background-color: rgba(255, 0, 0, 0.658);
            border-radius: 20px;
        }

        #msg{
            font-size: 36px;
            text-align: center;
        }


        img{
            width :70%;
        }
        body{
            position: relative;
        }

        body {
            background-color: white;
            background-image: url(./男子.png);
            background-size:500px;
            background-repeat: no-repeat;
            background-position: center;
            
        }
        #exampleModalLabel{
            font-weight: bold;
            font-size: 25px;
        }
 
        .modal-body{
            display: flex;
            justify-content: center;
        }

        .modal-body > img{
            width: 50%;
            height: 50%;
        }
        .modal-title{
            padding: 0px 50px;
        }
        #close_x{
            margin: 0px;
            padding: 0px;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <div box-id="1" class="col-1"></div>
            <div box-id="2" class="col-1"></div>
            <div box-id="3" class="col-1"></div>
            <div box-id="4" class="col-1"></div>
            <div box-id="5" class="col-1"></div>
            <div box-id="6" class="col-1"></div>
            <div box-id="7" class="col-1"></div>
            <div box-id="8" class="col-1"></div>
            <div box-id="9" class="col-1"></div>
            <div box-id="10" class="col-1"></div>
            <div box-id="11" class="col-1"></div>
            <div box-id="12" class="col-1"></div>
        </div>

        <div class="row">
            <div box-id="32" class="col-1"></div>
            <div id="msg" class="col-10"></div>
            <div box-id="13" class="col-1"></div>
        </div>

        <div class="row">
            <div box-id="31" class="col-1"></div>
            <div id=""  class="col-10">
            </div>
            <div box-id="14" class="col-1"></div>
        </div>

        <div class="row">
            <div box-id="30" class="col-1"></div>
            <div id=""  class="col-10"></div>
            <div box-id="15" class="col-1"></div>
        </div>

        <div class="row">
            <div box-id="29" class="col-1"></div>
            <div id="" class="col-3"></div>
            <button id="" class="col-4">有求有保庇！GO！</button>
            <div id="" class="col-3"></div>
            <div box-id="16" class="col-1"></div>
        </div>

        <div class="row">
            <div box-id="28" class="col-1"></div>
            <div box-id="27" class="col-1"></div>
            <div box-id="26" class="col-1"></div>
            <div box-id="25" class="col-1"></div>
            <div box-id="24" class="col-1"></div>
            <div box-id="23" class="col-1"></div>
            <div box-id="22" class="col-1"></div>
            <div box-id="21" class="col-1"></div>
            <div box-id="20" class="col-1"></div>
            <div box-id="19" class="col-1"></div>
            <div box-id="18" class="col-1"></div>
            <div box-id="17" class="col-1"></div>
        </div>   

    </div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="close_x">
                        <!-- <span aria-hidden="true">&times;</span> -->
                    </button>
                </div>
                <div class="modal-body">
                    <img id="resultPic">
                    Modal內容
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" id="close">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>

    <script>

        const brickData = [
                    {
                        id:"1",
                        color:"#00E6E6",
                        icon: "./不倒翁御守.png",
                        resultPic: "./日富一日.png",
                        target: function(){
                            return '1 多多累金'
                        }
                    },
                    {
                        id:"2",
                        color:"#EBEB00",
                        icon: "./富士山守.png",
                        resultPic: "./旅行七天守.png",
                        target: function(){
                            return '2 休息是為了走更長遠的路'
                        }
                    },
                    {
                        id:"3",
                        color:"#EBEB00",
                        icon: "./神社守.png",
                        resultPic: "./背單字守.png",
                        target: function(){
                            return '3 '
                        }
                    },
                    {
                        id:"4", color:"#EBEB00",
                        icon: "./富士山守.png",
                        resultPic: "./瘦十公斤守.png",
                        target: function(){
                            return '4'
                        }
                    },
                    {
                        id:"5",
                        color:"lightgreen",
                        icon: "./金魚守1.png",
                        resultPic: "./看五本書守.png",
                        target: function(){
                            return '5'
                        }
                    },
                    {
                        id:"6",
                        color:"#EBEB00",
                        icon: "./不倒翁御守.png",
                        resultPic: "./背單字守.png",
                        target: function(){
                            return '6'
                        }
                    },
                    {
                        id:"7",
                        color:"#EBEB00",
                        icon: "./富士山守.png",
                        resultPic: "./旅行七天守.png",
                        target: function(){
                            return '7'
                        }
                    },
                    {
                        id:"8",
                        color:"#EBEB00",
                        icon: "./金魚守1.png",
                        resultPic: "./瘦十公斤守.png",
                        target: function(){
                            return '9'
                        }
                    },
                    {
                        id:"9",
                        color:"lightgreen",
                        icon: "./神社守.png",
                        resultPic: "./日富一日.png",
                        target: function(){
                            return '9 最近有現金入袋的機會，訣竅是看緊你的荷包！'
                        }
                    },
                    {
                        id:"10",
                        color:"#00E6E6",
                        icon: "./金魚守1.png",
                        resultPic: "./看五本書守.png",
                        target: function(){
                            return '10'
                        }
                    },
                    {
                        id:"11",
                        color:"#EBEB00",
                        icon: "./不倒翁御守.png",
                        resultPic: "./旅行七天守.png",
                        target: function(){
                            return '11'
                        }
                    },
                    {
                        id:"12",
                        color:"#EBEB00",
                        icon: "./富士山守.png",
                        resultPic: "./背單字守.png",
                        target: function(){
                            return '12'
                        }
                    },
                    {
                        id:"13",
                        color:"#EBEB00",
                        icon: "./神社守.png",
                        resultPic: "./日富一日.png",
                        target: function(){
                            return '13'
                        }
                    },{
                        id:"14",
                        color:"#00E6E6",
                        icon: "./金魚守1.png",
                        resultPic: "./旅行七天守.png",
                        target: function(){
                            return '14'
                        }
                    },
                    {
                        id:"15",
                        color:"lightgreen",
                        icon: "./不倒翁御守.png",
                        resultPic: "./背單字守.png",
                        target: function(){
                            return '15 '
                        }
                    },
                    {
                        id:"16",
                        color:"#EBEB00",
                        icon: "./富士山守.png",
                        resultPic: "./看五本書守.png",
                        target: function(){
                            return '16'
                        }
                    },
                    {
                        id:"17",
                        color:"#EBEB00",
                        icon: "./神社守.png",
                        resultPic: "./瘦十公斤守.png",
                        target: function(){
                            return '17'
                        }
                    },
                    {
                        id:"18",
                        color:"#00E6E6",
                        icon: "./金魚守1.png",
                        resultPic: "./背單字守.png",
                        target: function(){
                            return '18'
                        }
                    },
                    {
                        id:"19",
                        color:"#EBEB00",
                        icon: "./不倒翁御守.png",
                        resultPic: "./瘦十公斤守.png",
                        target: function(){
                            return '19'
                        }
                    },
                    {
                        id:"20",
                        color:"#EBEB00",
                        icon: "./富士山守.png",
                        resultPic: "./旅行七天守.png",
                        target: function(){
                            return '20 '
                        }
                    },
                    {
                        id:"21",
                        color:"#EBEB00",
                        icon: "./神社守.png",
                        resultPic: "./看五本書守.png",
                        target: function(){
                            return '21 '
                        }
                    },
                    {
                        id:"22",
                        color:"#00E6E6",
                        icon: "./金魚守1.png",
                        resultPic: "./日富一日.png",
                        target: function(){
                            return '22'
                        }
                    },
                    {
                        id:"23",
                        color:"#EBEB00",
                        icon: "./不倒翁御守.png",
                        resultPic: "./背單字守.png",
                        target: function(){
                            return '23 '
                        }
                    },
                    {
                        id:"24",
                        color:"lightgreen",
                        icon: "./富士山守.png",
                        resultPic: "./看五本書守.png",
                        target: function(){
                            return '24'
                        }
                    },
                    {
                        id:"25",
                        color:"#EBEB00",
                        icon: "./金魚守1.png",
                        resultPic: "./日富一日.png",
                        target: function(){
                            return '25'
                        }
                    },
                    {
                        id:"26",
                        color:"lightgreen",
                        icon: "./神社守.png",
                        resultPic: "./背單字守.png",
                        target: function(){
                            return '26'
                        }
                    },
                    {
                        id:"27",
                        color:"#EBEB00",
                        icon: "./不倒翁御守.png",
                        resultPic: "./瘦十公斤守.png",
                        target: function(){
                            return '27 '
                        }
                    },
                    {
                        id:"28",
                        color:"#00E6E6",
                        icon: "./富士山守.png",
                        resultPic: "./旅行七天守.png",
                        target: function(){
                            return '28'
                        }
                    },
                    {
                        id:"29",
                        color:"#EBEB00",
                        icon: "./金魚守1.png",
                        resultPic: "./看五本書守.png",
                        target: function(){
                            return '29'
                        }
                    },
                    {
                        id:"30",
                        color:"#EBEB00",
                        icon: "./神社守.png",
                        resultPic: "./瘦十公斤守.png",
                        target: function(){
                            return '30'
                        }
                    },
                    {
                        id:"31",
                        color:"#00E6E6",
                        icon: "./不倒翁御守.png",
                        resultPic: "./日富一日.png",
                        target: function(){
                            return '31'
                        }
                    },
                    {
                        id:"32",
                        color:"lightgreen",
                        icon: "./金魚守1.png",
                        resultPic: "./背單字守.png",
                        target: function(){
                            return '32'
                        }
                    }
                ]

        //宣告
        let steps = 0;
        let allsteps = 0; //全部的步數
        let currentIdx = 0; //目前走到哪一格
        let speed;  //速率，越大表示越慢
        let bricks
        let msg = document.querySelector("#msg")
        let modal = document.getElementById('exampleModal');
        let close = document.getElementById('close_x').addEventListener("click" , function(){
            $(modal).modal('hide'); 
        });
        let closeBtn = document.getElementById('close').addEventListener("click" , function(){
            $(modal).modal('hide'); 
        });


        //設定 brick 的裡面資料
        let brickNodes = document.querySelectorAll("[box-id]");
        console.log(brickNodes) //是節點集合 NodeList(32)
        bricks =[...brickNodes].sort( (a,b) =>{
            return a.getAttributeNode("box-id").value - b.getAttributeNode("box-id").value;         
            //他要 return 回 bricks 自己，所以不要再宣告一個變數
            //return 一定要直接放在那串 code 之前...
        })
        console.log(bricks) //現在是陣列

        
        bricks.forEach((item,idx) => {
            //我要為每一個 brick 加上資料表設定的顏色
            let brickID = idx +1; //讓陣列裡 brick 的索引從 1 開始，所以要加一
            let data = brickData.find(data => data.id == brickID);
            console.log(data)
            item.style.color = data.color
            let icon = document.createElement("img");
            icon.src = data.icon;
            item.append(icon);
        })

        
        //開始按鈕
        document.querySelector("button").addEventListener("click", function(){
            getSteps();
            turnAround();
        })

        //方法
        function getSteps(){
            //取得亂數，0 ~ 32 之間，讓他不要停在，讓他不要停在第一格
            let random = Math.floor(Math.random() * brickData.length + 1)
            console.log(random)
            //設定要走的步數
            steps = random + (brickData.length *3)
            //因為要讓 step 遞減歸零，所以要再取一個總步數，用來放慢角度 (搭配 speed)
            allsteps= steps;
            //速度
            speed = 50
        }

        function turnAround(){
            //要自動讓他自動化
            console.log(`This is allsteps： ${steps} ............`)

            for(let i=1; i < (steps+1)/2; i++){
                //走每一步，都會去執行一次 active移除 & 增加
                //立即實行沒用，快的還是會先跑
                //加上 else ，剩餘 step 會有錯
                (function(t){ 
                    setTimeout(()=>{
                        // console.log(`迴圈一的i圈數：${i}...`)
                        // console.log(`before+ active的 currentIdx：${currentIdx}`)                     
                        bricks[currentIdx].classList.remove("active");
                        currentIdx++;
                    
                    // for(let i=0; i > brickData.length; steps--){
                        // console.log(currentIdx)
                        if(currentIdx >= brickData.length){
                            currentIdx=0
                        }  
                        // else{
                            bricks[currentIdx].classList.add("active");
                            // console.log(`after+ active的 currentIdx：${currentIdx}`)                   
                            steps = steps -1;
                            // console.log(`steps--的：${steps}...`)                           
                            
                            // }
                            
                            if(steps== 0){ 
                            console.log(0);                      
                            let resultText = brickData[currentIdx].target(); 
                           
                            let modalTitle = modal.querySelector('.modal-title');
                            modalTitle.innerText = `今日錦囊： ${resultText}`;

                            let modalBody = modal.querySelector('.modal-body');
                            let imgElement = document.createElement('img');
                            imgElement.src =brickData[currentIdx].resultPic;
                            modalBody.innerHTML = '';
                            modalBody.appendChild(imgElement);

                            $(modal).modal('show');                 

                        }
                        
                    },60*i)
                    })(i)
                    
                
                }

            for(let i=0; i < allsteps - steps/2; i++){
                //走每一步，都會去執行一次 active移除 & 增加
               
                    setTimeout(()=>{
                        // console.log(`迴圈二i圈數：${i}...`)
                        console.log(`before+ active的 currentIdx：${currentIdx}`)                     
                        bricks[currentIdx].classList.remove("active");
                        currentIdx++;
                    
                    // for(let i=0; i > brickData.length; steps--){
                        // console.log(currentIdx)
                        if(currentIdx >= brickData.length){
                            currentIdx=0
                        }  
                        // else{
                            bricks[currentIdx].classList.add("active");
                            // console.log(`after+ active的 currentIdx：${currentIdx}`)                   
                            steps = steps -1;
                            // console.log(`steps--的：${steps}...`)   
                        // }
        
                    },40*i)
                  
            }


              
    
            //助教版
            // bricks[currentIdx].classList.remove("active");
            // currentIdx++;
            
            // if (currentIdx >= bricks.length){
            //     currentIdx = 0
            // }           
            // bricks[currentIdx].classList.add("active");
            // steps--;
            // console.log(currentIdx)
            // console.log(steps)

            // if (steps > 0){
            //     setTimeout(turnAround, speed);
                
            //     if (steps < Math.floor((allsteps / 3))) {
            //         speed = 100;
            //     }
            // }
            // else{
            //     //走完了
            //     msg.innerText = brickData[currentIdx].target();
            // }
                                    
        }


        



    </script>
</body>
</html>