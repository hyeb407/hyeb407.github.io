<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./grid.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <style>
        .pic-box{
            position: sticky;
            top: 115px;
            /* border: 2px solid #ccc; */
            box-shadow: 0 0px 0px 0 rgba(0, 0, 0, 0.111), 0 0px 10px 0 rgba(0, 0, 0, 0.19);
            border-radius: 20px;
            overflow: hidden;
        }
        .pic{
            width: 100%;
            display: block;
            /* position: sticky;
            top: 0; */
        }

        .list{
            margin: auto;
            display: flex;
            /* flex-direction: row; */
            flex-wrap: wrap;
            /* justify-content: center; */
        }
        .section-title{
            width: 100%;
        }
        .card{
            /* min-width: 150px;
            max-width: 280px; */
            border:1px solid #ccc;
            border-radius: 10px;
            text-align: center;
            padding: 20px;
            /* display: flex;
            place-content: center; */
        }
        .card:hover{
            border:1.5px solid rgba(61, 109, 255, 0.461);
        }
        button{
            width: 100%;
            border: none;
            border-radius: 20px;
            padding: 10px;
            background-color: rgb(61, 109, 255);
            color: white;
        }
        
        .circle{
            width: 40px;
            height: 40px;
            border-radius: 30px;
            margin: auto; 
        }
        .gray{
            background-color: #ccc;
        }
        .silver{
            background-color: aliceblue;
        }
        .rose{
            background-color: rgb(228, 192, 188);
        }
        .purple{
            background-color: rgb(177, 154, 205);
        }
        .blue{
            background-color: rgb(153, 176, 196);
        }
        h5{
            margin-top: 20px;
        }
        h5 span{
            font-size: 10px;
            color: #646464;
            display: block;
            margin: 10px;
        }
        .price-box{
            font-size: 30px;
            border: none;
        }

        .navbar{
            position: sticky;
            top: 0px;
            z-index: 1;
        }
        .nav-link{
            width: 150px;
            text-align: center;
        }
        .nav-link:hover{
            color: rgb(61, 109, 255);
            border-radius: 20px;
            font-weight: bolder;
        }
        </style>
</head>
<body>
    
    
    <!-- navbar 區域 -->
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <!-- 不要滿版 <div class="container-fluid"> -->
        <div class="container">
        <a class="navbar-brand" href="#">apple</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mx-auto">

              <!-- <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">Home</a>
              </li> -->

              <li class="nav-item">
                <a class="nav-link" href="#">iPhone</a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="#">iPad</a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="#">Mac</a>
              </li>

            </ul>
     
          </div>
        </div>
      </nav>    
</header>
  

    <!-- 圖片+選項區塊 -->
    <div class="container">
        <div class="row">
            <!-- 圖片區 -->
            <div class="col-12 col-md-6 col-lg-6 col-xl-6">
                <div class="pic-box">
                    <img class="pic" src="https://raw.githubusercontent.com/hyeb407/FileStorage-02/main/iPadAir%20pics/iPad_air%2001.jpg" alt="">
                </div>
            </div>
                
            <!-- 顏色選項 -->
            <div class="sub-container col-12 col-md-6 col-lg-6 col-xl-6">
                <section class="list col-12 col-md-12 col-lg-12 col-xl-12">
                    <div class="col-6 col-md-6 col-lg-6 col-xl-6">
                        <div class="card colorBtn" id="太空灰色">
                            <div class="circle gray"></div>
                            <h5 class="colorBtnName">太空灰</h5>   
                        </div>
                    </div>
                    
                    <div class="col-6 col-md-6 col-lg-6 col-xl-6">
                        <div class="card colorBtn" id="銀色">
                            <div class="circle silver"></div>
                            <h5 class="colorBtnName">銀色</h5>               
                        </div>
                    </div>
                    
                    <div class="col-6 col-md-6 col-lg-6 col-xl-6">
                        <div class="card colorBtn" id="玫瑰金色">
                            <div class="circle rose"></div>
                            <h5 class="colorBtnName">玫瑰金</h5>               
                        </div>
                    </div>
                    
                    <div class="col-6 col-md-6 col-lg-6 col-xl-6">
                        <div class="card colorBtn" id="紫色">
                            <div class="circle purple"></div>
                            <h5 class="colorBtnName">紫色</h5>               
                        </div>
                    </div>
                    
                    <div class="col-6 col-md-6 col-lg-6 col-xl-6">
                        <div class="card colorBtn" id="天藍色">
                            <div class="circle blue"></div>
                            <h5 class="colorBtnName">天藍色</h5>               
                        </div>
                    </div>
                </section>
            
                    
                
                <!-- 儲存裝置選項 -->
                <section class="list col-12 col-md-12 col-lg-12 col-xl-12">          
                    <div class="section-title">儲存空間</div>
                            <div class="col-6 col-md-6 col-lg-6 col-xl-6">
                                
                                <div class="card storageBtn" id="64GB">
                                    <!-- <div class="circle gray"></div> -->
                                    <h5 class="storageBtnName">64GB<span></span></h5>   
                                </div>
                            </div>
                            
                            <div class="col-6 col-md-6 col-lg-6 col-xl-6">
                                <div class="card storageBtn" id="256GB">
                                    <!-- <div class="circle silver"></div> -->
                                    <h5 class="storageBtnName">256GB<span></span></h5>               
                                </div>
                            </div>
                </section>
                
                
                
                <!-- 連線能力 network 選項 -->
                <section class="list col-12 col-md-12 col-lg-12 col-xl-12">            
                    <div class="section-title">連線能力</div>
                        <div class="col-12 col-md-12 col-lg-12 col-xl-12">
                            <div class="card networkBtn" id="Wi-Fi">
                                <!-- <div class="circle gray"></div> -->
                                <h5 class="networkBtnName">Wi-Fi<span>每部 iPad 都可連接到 Wi-Fi 網路，使你能保持連線。 </span></h5>   
                            </div>
                        </div>
                        
                        <div class="ol-12 col-md-12 col-lg-12 col-xl-12">
                            <div class="card networkBtn" id="Cellular">
                                <!-- <div class="circle silver"></div> -->
                                <h5 class="networkBtnName">Wi-Fi + 行動網路<span>Wi-Fi + 行動網路機型讓你在無法使用 Wi-Fi 時也能進行連線。</span></h5>               
                            </div>
                        </div>
                </section>
                                     
                <!-- 價格試算 -->
                <section class="list col-12 col-md-12 col-lg-12 col-xl-12">
                    <div class="section-title">價格試算</div>
                        <div class="col-12 col-md-12 col-lg-12 col-xl-12">
                            <div class="card price-box" id="">NT$19,000 起</div>
                            <div class="col-12 col-md-12 col-lg-12 col-xl-12">
                                <button>繼續</button>
                            </div>
                        </div>
                </section>
            </div>
        </div>
    </div>

    <!-- 定義一個 Template  -->
    <template id="subContainer">
        <div class="sub-container col-12 col-md-6 col-lg-6 col-xl-6">
            <div class="section-title">儲存空間</div>
            <section class="list listTemp col-12 col-md-12 col-lg-12 col-xl-12">

            </section>
        </div>
    </template>
    
    
    
    <template id="cardBtnColor">
        <div class="col-6 col-md-6 col-lg-6 col-xl-6">
            <div class="card colorBtn cardTemp" id="太空灰色">
                <!-- <div class="circle circleTemp"></div> -->
                <img src="" class="circle circleTemp">
                <h5 class="colorBtnName colorNameTemp">太空灰</h5>   
            </div>
        </div>
    </template>

    <template id="cardBtn">
        <div class="col-6 col-md-6 col-lg-6 col-xl-6">                             
            <div class="card cardTemp2" id="每個按鈕的ID">
                <h5 class="BtnName NameTemp">公版文字<span></span></h5>   
            </div>
        </div>
    </template>
   
    

    
    <script type="module">
        import { $g } from './helpers.js';

        // 一、宣告 + 取得 DOM
        const url = "https://raw.githubusercontent.com/hyeb407/hyeb407.github.io/main/JS_HW5%20Apple/AppleSeries.json";
        //陣列結構，其實還是文字，要 parse 還原陣列或物件
        
        let jsonParseArr = [];
        let colorFilterArr;
        let storageFilterArr;
        let networkFilterArr;
        let uri = './ApplePics/ipadColor/'

        // let xhr =new XMLHttpRequest();
        let colorPic;
        let showPrice;
              
        let picBox = document.querySelector(".pic-box");
        let priceBox = document.querySelector(".price-box");
        let pic = document.querySelector(".pic");
        let colorBtns = document.querySelectorAll(".colorBtn")
        let storageBtns = document.querySelectorAll(".storageBtn")
        let networkBtns = document.querySelectorAll(".networkBtn")
       

        let subContainer  =$g("#subContainer")
        let btnTemplateColor = $g('#cardBtnColor'); //定義的 Template id
        let btnTemplate = $g('#cardBtn'); //定義的 Template id
        let colorID , btnID
        let allColorBtns, allStorageBtns
        let specAutoArr=[];
        let ipadSpecArr = [];
        let xhr = new XMLHttpRequest();
        
   
        //二、加入監聽
            colorBtns.forEach( colorNode => {
                let colorId = colorNode.getAttribute("id");
                //不要用 e.target 避免冒泡事件，文字會回傳null
                console.log(colorId);

                colorNode.addEventListener("click" ,function(event){
                    // getIpadJson(url)
                    colorFilter(colorId)
                })              
                // e.innerText = colorBtn.innerText;
                // e.addEventListener("click" , requestIpadJson.bind(event, url))
            })

            storageBtns.forEach( storageNode => {
                let storageId = storageNode.getAttribute("id");
                console.log(storageId);

                storageNode.addEventListener("click" , function(event){
                    storageFilter(storageId)
                })                
            })

            networkBtns.forEach( netNode => {
                let networkId = netNode.getAttribute("id");
                console.log(networkId);

                netNode.addEventListener("click" , function(event){
                    networkFilter(networkId)
                })                
            });



        //三、方法
        window.onload = function(){
            getIpadJson(url)
        }



        function getIpadJson(uriii) {
            xhr.onload = function () {
                jsonParseArr = JSON.parse(this.responseText);
  
                autoColorBtn()
                storageFilter()
                networkFilter()
                               
            };
            xhr.open("GET", uriii);
            xhr.send();
        }

        function autoColorBtn(){
            let ipadOutWarddArr=[];             
            ipadOutWarddArr = jsonParseArr.IPad.OutWard;
                //現在是陣列，所以要 forEach 取裡面的 color
            //(5) [{…}, {…}, {…}, {…}, {…}]
            // 0: {color: '太空灰色', colorValue: '#6e6969', imageUrl: './ApplePics/ipadColor/太空灰色.png'}
            // 1: {color: '星光色', colorValue: '#b9aeae', imageUrl: './ApplePics/ipadColor/星光色.png'}
            // 2: {color: '粉紅色', colorValue: '#ceb7a8', imageUrl: './ApplePics/ipadColor/粉紅色.png'}
            // 3: {color: '紫色', colorValue: '#ceb7a8', imageUrl: './ApplePics/ipadColor/紫色.png'}
            // 4: {color: '天藍色', colorValue: '#ceb7a8', imageUrl: './ApplePics/ipadColor/天藍色.png'}
        
            //生成顏色按鈕
            ipadOutWarddArr.forEach(item =>{
                allColorBtns = colorBtnInfo(item.color ,item.pic)   //顏色 & 平板圖片   
                            
                // 使用 template 一定要 .content.cloneNode(true)
                let colneSubContainer = subContainer.content.cloneNode(true)
                let section = colneSubContainer.querySelector(".listTemp")
                section.append(allColorBtns)   //顏色 & 平板圖片   
                
                //創造一個 row 放 colneSubContainer
                let row = document.createElement("div");
                row.classList.add("row")
                row.append(colneSubContainer)
                document.body.append(row)               
            })   
        }
        
        function colorBtnInfo(item,pic){
            console.log(item) // 太空灰色、星光色、粉紅色、紫色、天藍色
            console.log(pic) 


            // <div class="card colorBtn cardTemp" id="太空灰色">
            //     <img src="" class="circle circleTemp">
            //     <h5 class="colorBtnName colorNameTemp">太空灰</h5> 

            let cloneCard = btnTemplateColor.content.cloneNode(true); //參數要帶 true 才會層層複製
            colorID= cloneCard.querySelector(".cardTemp").id = item;
            console.log(colorID)
         

            cloneCard.querySelector(".circleTemp").src = uri+item+'.png';

            cloneCard.querySelector(".colorNameTemp").innerText = item;

            cloneCard.querySelector(".cardTemp").addEventListener("click" , function(){
                alert(item);
                // colorFilter(colorID)
                //呼叫更圖片的方法...重新撰寫
             
                colorPic=getPic(pic)
                // console.log(pic)
                // console.log(colorPic)
                picBox.innerHTML = colorPic;
            });
            console.log(colorPic)
            
            
            return cloneCard;
            //製作好的卡片回覆給呼叫端
        }


        function getPic(pic) {
            // console.log(ipad)
            console.log(pic)
            
            
            // let imgUrl = `https://raw.githubusercontent.com/hyeb407/hyeb407.github.io/main/JS_HW5%20Apple/ApplePics/ipad/${ipad.picture}`;
            let imgUrl = `https://raw.githubusercontent.com/hyeb407/hyeb407.github.io/main/JS_HW5%20Apple/ApplePics/ipad/${pic}`;
            console.log(imgUrl)

            
            let pics = `
                <img src="${imgUrl}" class="pic" alt=""> `;

            // let cardString = `
            // <div class="card" style="width: 18rem;">
            //     <img src="${imgUrl}" class="card-img-top" alt="${ipad.id}">
            //     <div class="card-body">
            //         <h5 class="card-id">${ipad.id}</h5>
            //         <p class="card-text">NT ${ipad.price}</p>
            //         </div>
            //         </div> `;
            return pics;
        }

        function storageFilter() { 
            // storageFilterArr = colorFilterArr.filter(ipad => ipad.storage == storage)
            
            //取得 jsonParseArr 裡面的 IPad 裡面的 Spec 資料
            
            ipadSpecArr = jsonParseArr.IPad.Spec;
            console.log(`ipadSpecArr...`)
            console.log(ipadSpecArr);
            
            // let storageArr = ipadSpecArr.filter( storageItem => storageItem.storage == storage)
            
            
            ipadSpecArr.forEach(item=>{
                if(! specAutoArr.includes(item.storage)){
                     specAutoArr.push(item.storage)
                     console.log(specAutoArr)    
                        
                        allStorageBtns = getBtn(item.storage)   
                        console.log(item.storage)             
                        
                        // 使用 template 一定要 .content.cloneNode(true)
                        let colneSubContainer = subContainer.content.cloneNode(true)
                        let section = colneSubContainer.querySelector(".listTemp")
                        section.append(allStorageBtns)   
                        
                        //創造一個 row 放 colneSubContainer
                        let row = document.createElement("div");
                        row.classList.add("row")
                        row.append(colneSubContainer)
                        document.body.append(row)
                    }
            })

        };

        function getBtn(item){
            console.log(item) 
            
            // <template id="cardBtn">
            //     <div class="col-6 col-md-6 col-lg-6 col-xl-6">                             
            //         <div class="card cardTemp2" id="每個按鈕的ID">
            //             <h5 class="BtnName NameTemp">公版文字<span></span></h5>   
            //         </div>
            //     </div>
            // </template>

            let cloneBtn = btnTemplate.content.cloneNode(true); //參數要帶 true 才會層層複製
            btnID = cloneBtn.querySelector(".cardTemp2").id = item;
            console.log(btnID)
            cloneBtn.querySelector(".NameTemp").innerText = item;
            cloneBtn.querySelector(".cardTemp2").addEventListener("click" , function(){
                console.log(`${item}加裝監聽成功`);
                console.log(ipadSpecArr.filter(x=>x.item == item))
                showPrice = item.price
                console.log(showPrice); 
            });
           
            return cloneBtn;
            //製作好的卡片回覆給呼叫端
        }

        function networkFilter() { 

            // storageFilterArr.filter(ipad => ipad.network == network).forEach(item => {
            //     console.log(item);    
            //     showPrice = item.price
            //     console.log(showPrice); 
            // })
            // priceBox.innerText = `$ ${showPrice}`;
            
            // networkFilterArr = storageFilterArr.filter(ipad => ipad.network == network)

            ipadSpecArr.forEach(item=>{
                if(! specAutoArr.includes(item.network)){
                     specAutoArr.push(item.network)
                     console.log(specAutoArr)    
                        
                        allStorageBtns = getBtn(item.network)   
                        console.log(item.network)             
                        
                        // 使用 template 一定要 .content.cloneNode(true)
                        let colneSubContainer = subContainer.content.cloneNode(true)
                        let section = colneSubContainer.querySelector(".listTemp")
                        section.append(allStorageBtns)   
                        
                        //創造一個 row 放 colneSubContainer
                        let row = document.createElement("div");
                        row.classList.add("row")
                        row.append(colneSubContainer)
                        document.body.append(row)

                        
                    }
            })

        };



    

    </script>
</body>
</html>