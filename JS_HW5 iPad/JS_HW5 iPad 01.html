<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./grid.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <style>
       
        .pic-box{
            /* margin: 50px; */
            /* min-width: 300px;
            max-width: 600px; */
            min-height: 200px;
            border: 1px solid #ccc;
            padding: 10px;
            display: flex;
            justify-content: center;
            position: sticky;
            
        }
        .list{
            margin: auto;
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-end;
        }
        .pic{
            width: 100%;
            display: block;
        }
        .card{
            border:1px solid #ccc;
            border-radius: 10px;
            text-align: center;
            padding: 10px;
            display: flex;
            place-content: center;
        }

        .circle{
            width: 40px;
            height: 40px;
            border-radius: 30px;
            margin: 10px; 
        }
        .gray{
            background-color: #ccc;
        }
        .silver{
            background-color: aliceblue;
        }
        .rose{
            background-color: rgb(228, 192, 188);
        }
        .purple{
            background-color: rgb(177, 154, 205);
        }
        .blue{
            background-color: rgb(153, 176, 196);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <!-- 圖片區 -->
            <div class="col-12 col-md-6">
                <div class="pic-box">234565345654
                    <img class="pic" src="" alt="">
                </div>
            </div>
                
            <!-- 顏色選項 -->
            <div class="row">

                <div class="list col-12 col-md-6">
                    <div class="col-6 col-md-6">
                    <div class="card colorBtn" id="太空灰色">
                        <div class="circle gray"></div>
                        <h5 class="colorBtnName">太空灰</h5>   
                    </div>
                </div>

                <div class="col-6 col-md-6">
                    <div class="card colorBtn" id="銀色">
                        <div class="circle silver"></div>
                        <h5 class="colorBtnName">銀色</h5>               
                    </div>
                </div>
                
                <div class="col-6 col-md-6">
                    <div class="card colorBtn" id="玫瑰金色">
                        <div class="circle rose"></div>
                        <h5 class="colorBtnName">玫瑰金</h5>               
                    </div>
                </div>
                
                <div class="col-6 col-md-6">
                    <div class="card colorBtn" id="紫色">
                        <div class="circle purple"></div>
                        <h5 class="colorBtnName">紫色</h5>               
                    </div>
                </div>
                
                <div class="col-6 col-md-6">
                    <div class="card colorBtn" id="天藍色">
                        <div class="circle blue"></div>
                        <h5 class="colorBtnName">天藍色</h5>               
                    </div>
                </div>
                
                
                <!-- 儲存裝置選項 -->
                <!-- <div class="list col-12 col-md-6"> -->
                    <section class="sub-title">儲存空間</section>
                    <div class="col-6 col-md-6">
                        <div class="card storageBtn" id="64GB">
                            <!-- <div class="circle gray"></div> -->
                            <h5 class="storageBtnName">64GB<span>$0,000起</span></h5>   
                        </div>
                    </div>
                    
                    <div class="col-6 col-md-6">
                        <div class="card storageBtn" id="256GB">
                        <!-- <div class="circle silver"></div> -->
                        <h5 class="storageBtnName">256GB<span>$0,000起</span></h5>               
                    </div>
                </div>
                <!-- </div> -->
            
                <!-- 連線能力 network 選項 -->
                <!-- <div class="list col-12 col-md-6"> -->
                    <div class="col-6 col-md-6">
                        <div class="card networkBtn" id="Wi-Fi">
                            <!-- <div class="circle gray"></div> -->
                            <h5 class="networkBtnName">Wi-Fi</h5>   
                        </div>
                    </div>
                    
                    <div class="col-6 col-md-6">
                        <div class="card networkBtn" id="Cellular">
                            <!-- <div class="circle silver"></div> -->
                            <h5 class="networkBtnName">Wi-Fi + 行動網路</h5>               
                        </div>
                </div>
                <!-- </div> -->
                
                <!-- 鐫刻選項 -->
                <div class="list col-12 col-md-6">
                    <div class="col-6 col-md-6">
                        <div class="card storageBtn" id="">
                            <!-- <div class="circle gray"></div> -->
                            <h5 class="colorBtnName">加雷射</h5>   
                        </div>
                    </div>
                    
                    <div class="col-6 col-md-6">
                        <div class="card storageBtn" id="">
                            <!-- <div class="circle silver"></div> -->
                            <h5 class="colorBtnName">不加雷射</h5>               
                        </div>
                    </div>
                </div>
                
                <!-- 價格試算 -->
                <div class="list col-12 col-md-6">
                    <div class="col-12 col-md-6">
                        <div class="card price-box" id="">價格 $$$</div>
                        <button>繼續</button>
                    </div>
                </div>
                
            </div>
            </div>
        </div>
    </div>
    
    
    <script>
        // 一、宣告 + 取得 DOM
        const url = "https://raw.githubusercontent.com/hyeb407/FileStorage-02/main/ipadair2023.json";
        //陣列結構，其實還是文字，要 parse 還原陣列或物件
        
        let ipadArray = [];
        let colorFilterArr=[];
        let storageFilterArr=[];
        let networkFilterArr=[];
        
        let colorFilterB;
        let storageFilterB;
        
        let xhr =new XMLHttpRequest();
        let colorPic;
        let showPrice;
              
        let picBox = document.querySelector(".pic-box");
        let priceBox = document.querySelector(".price-box");
        let pic = document.querySelector(".pic");
        let colorBtns = document.querySelectorAll(".colorBtn")
        let storageBtns = document.querySelectorAll(".storageBtn")
        let networkBtns = document.querySelectorAll(".networkBtn")
       
     
   
        //二、加入監聽
        window.onload = function () {

            colorBtns.forEach( colorNode => {
                let colorId = colorNode.getAttribute("id");
                //不要用 e.target 避免冒泡事件，文字會回傳null
                console.log(colorId);

                colorNode.addEventListener("click" ,function(event){
                    requestIpadJson(url,colorId)
                })              
                // e.innerText = colorBtn.innerText;
                // e.addEventListener("click" , requestIpadJson.bind(event, url))
            })

            storageBtns.forEach( storageNode => {
                let storageId = storageNode.getAttribute("id");
                console.log(storageId);

                storageNode.addEventListener("click" , function(event){
                    storageFilter(url,storageId)
                })                
            })

            networkBtns.forEach( netNode => {
                let networkId = netNode.getAttribute("id");
                console.log(networkId);

                netNode.addEventListener("click" , function(event){
                    networkFilter(networkId)
                })                
            })

        };



        //三、方法      
        function requestIpadJson(uriii, color) { 
            console.log(uriii)       
            xhr.onload = function () {
                ipadArray = JSON.parse(this.response);               
                console.log(`ipadArray...`)
                console.log(ipadArray);
                
                console.log(color);
                let arr = ipadArray.filter(ipad => ipad.color == color) 
                arr.forEach(ipad => {
                    console.log(ipad); //直接是物件
                    colorPic = getPic(ipad);
                    
                    // console.log(`colorPic...`)
                    // console.log(colorPic);
                });

                picBox.innerHTML = colorPic;
                
                
                //把物件推進陣列，較好操作，而且用變數的方法失敗...
                colorFilterArr.push(ipadArray.filter(ipad => ipad.color == color))    
                console.log(`colorFilterArr.................`)
                console.log(colorFilterArr)
  
                
                
                //改為非陣列，用一個全域變數承接 filter 結果...失敗
                colorFilterB = ipadArray.filter(ipad => ipad.color == color)
                // .forEach(ipad => {
                //     colorPic = getPic(ipad);
                // });
                console.log(colorFilterB) //undefined

            }           
            xhr.open("GET", uriii);
            xhr.send();
        }
        
        function getPic(ipad) {
            // console.log(ipad)
            //參數改一個，因為一個一個迭代出來
            // if(ipadArray.filter( ipad => ipad.color == "太空灰")){               
                let imgUrl = `https://raw.githubusercontent.com/hyeb407/FileStorage-02/main/iPadAir%20pics/${ipad.picture}`;

            // };
            // if(ipadArray.filter( ipad => ipad.color == "紫色")){               
            //     let imgUrl = `https://raw.githubusercontent.com/hyeb407/FileStorage-02/main/iPadAir%20pics/purple.jpg`;
            // };
            
            let pics = `
            <div class="card" style="width: 18rem;">
                <img src="${imgUrl}" class="card-img-top" alt="${ipad.id}"> `;

            // let cardString = `
            // <div class="card" style="width: 18rem;">
            //     <img src="${imgUrl}" class="card-img-top" alt="${ipad.id}">
            //     <div class="card-body">
            //         <h5 class="card-id">${ipad.id}</h5>
            //         <p class="card-text">NT ${ipad.price}</p>
            //         </div>
            //         </div> `;
            return pics;
        }

        // function storageFilter(uriii,storage) { 
        //     console.log(storage) //有進來     
            
        //     xhr.onload = function () {
        //         ipadArray = JSON.parse(this.response);               
        //         console.log(`colorFilterArr...`)
        //         console.log(colorFilterArr); //有 color 過濾完的陣列
                        

        //         colorFilterArr.filter(ipad => ipad.storage == storage) //沒有了
                
        //         storageFilterArr.push(colorFilterArr.filter(ipad => ipad.storage == storage))
        //         console.log(`storageFilterArr...`)
        //         console.log(storageFilterArr);
   
        //         }
                
        //         xhr.open("GET", uriii);
        //         xhr.send();
        //     }           

        function storageFilter(uriii, storage) { 
      
            console.log(storage) //有參數的值
            console.log(`colorFilterArr.................`)
            console.log(colorFilterArr) //有進來            
            
            // colorFilterArr = JSON.parse();

            colorFilterArr.filter(ipad => ipad.storage == storage).forEach(i => {
                console.log(`i...`); 
                console.log(i);  //沒東西.........
            })
        
            colorFilterArr.map(x=> x.filter(ipad => ipad.storage == storage)).forEach(item => {
                console.log(item);  //有東西了..乾.........
                storageFilterArr.push(item);
                
            })

            // console.log(`storageFilterB.................`)
            // console.log(storageFilterB)    
            
            // storageFilterArr.push(colorFilterArr.map(x=> x.filter(ipad => ipad.storage == storage)))
            console.log(`storageFilterArr...`)
            console.log(storageFilterArr);


            // console.log(`colorFilterB.................`)
            // console.log(colorFilterB) //undefined
            // colorFilterB.filter(ipad => ipad.storage == storage) //Uncaught TypeError: Cannot read properties of undefined (reading 'filter')
            //at storageFilter (JS_HW5 iPad 01.html:323:26)
            //at HTMLDivElement.<anonymous> (JS_HW5 iPad 01.html:220:21)

        };

        function networkFilter(network) { 


            storageFilterArr.map(x=> x.filter(ipad => ipad.network == network))
        
            storageFilterArr.map(x=> x.filter(ipad => ipad.network == network)).forEach(item => {
                console.log(item);    
                showPrice = item.map (p=> p.price)
                console.log(showPrice); 
            })
            priceBox.innerText = `$ ${showPrice}`;
            



            //接續選項....
            networkFilterArr.push(storageFilterArr.map(x=> x.filter(ipad => ipad.network == network)))
            console.log(`networkFilterArr...`)
            console.log(networkFilterArr);
        };
    

    </script>
</body>
</html>